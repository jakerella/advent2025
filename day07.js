
const data = getInput().split('\n').map(l => l.split(''))

let p1 = 0
for (let y=0; y<data.length-1; ++y) {
    for (let x=0; x<data[y].length; ++x) {
        if (data[y][x] === '|') {
            if (data[y+1][x] === '.') {
                data[y+1][x] = '|'
            } else if (data[y+1][x] === '^') {
                p1++
                if (data[y+1][x-1]) { data[y+1][x-1] = '|' }
                if (data[y+1][x+1]) { data[y+1][x+1] = '|' }
            }
        }
    }
}

console.log('Part 1:', p1)


let beams = { 0: {} }
let s = data[0].indexOf('|')
beams[0][s] = 1
for (let y=1; y<data.length-1; ++y) {
    beams[y] = {}
    for (let x=0; x<data[y].length; ++x) {
        if (data[y].indexOf('^') < 0) {
            beams[y] = {...beams[y-1]}
            continue
        }
        if (data[y][x] === '^' && data[y-1][x] === '|') {
            beams[y][x-1] = (beams[y][x-1]) ? beams[y][x-1] + beams[y-1][x] : (beams[y-1][x] || 1)
            beams[y][x+1] = (beams[y][x+1]) ? beams[y][x+1] + beams[y-1][x] : (beams[y-1][x] || 1)
        } else if (data[y][x] === '|' && data[y-1][x] === '|') {
           beams[y][x] = (beams[y][x]) ? beams[y][x] + beams[y-1][x] : beams[y-1][x]
        }
    }
}
// console.log(beams)
const last = Object.keys(beams).sort((a,b) => a-b).pop()
const p2 = Object.keys(beams[last]).reduce((p, c) => { return p + beams[last][c] }, 0)

console.log('Part 2:', p2)


function getInput(test) {
    if (test) {
        return `.......|.......
...............
.......^.......
...............
......^.^......
...............
.....^.^.^.....
...............
....^.^...^....
...............
...^.^...^.^...
...............
..^...^.....^..
...............
.^.^.^.^.^...^.
...............`
    }
    return `......................................................................|......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^.^.^....................................................................
.............................................................................................................................................
...................................................................^.^.^.^...................................................................
.............................................................................................................................................
..................................................................^.^.^.^.^..................................................................
.............................................................................................................................................
.................................................................^.^...^.^.^.................................................................
.............................................................................................................................................
................................................................^...^...^.^.^................................................................
.............................................................................................................................................
...............................................................^.^...^.^.^...^...............................................................
.............................................................................................................................................
..............................................................^.^.^.^.^.....^.^..............................................................
.............................................................................................................................................
.............................................................^.....^.^.^.^...^.^.............................................................
.............................................................................................................................................
............................................................^.^.^...^.^.^.^.^.^.^............................................................
.............................................................................................................................................
...........................................................^...^.^.^.^...^...^...^...........................................................
.............................................................................................................................................
..........................................................^.^.^.^.^.^.....^.^.^...^..........................................................
.............................................................................................................................................
.........................................................^...^.^.......^...^.......^.........................................................
.............................................................................................................................................
........................................................^.^...^.^.^.^.^.....^...^.^.^........................................................
.............................................................................................................................................
.......................................................^...^...^...^.^...^.^.^.^...^.^.......................................................
.............................................................................................................................................
......................................................^.^.^.^.^...^.^.^...^.^.^.^.^...^......................................................
.............................................................................................................................................
.....................................................^.^.^.^.....^...^.........^.^...^.^.....................................................
.............................................................................................................................................
....................................................^.^.^.^.^.^.^.^.^...^.^.^.....^...^.^....................................................
.............................................................................................................................................
...................................................^...^.^...^.^...^.^.^.^.^...^.^.^.^.^.^...................................................
.............................................................................................................................................
..................................................^.....^.^.^...^.^.....^.^...^.^.^.^.^.^.^..................................................
.............................................................................................................................................
.................................................^.^.^...^.....^...^...^.^.^.^.^.^.^.^.^...^.................................................
.............................................................................................................................................
................................................^.^...^...^.^...^.^.^...^.^.....^...^.....^.^................................................
.............................................................................................................................................
...............................................^.^.^...^.^.....^...^...^...^.^...^.^.^.......^...............................................
.............................................................................................................................................
..............................................^...^.^...^.......^.^.^.^.^.^.^.^.^...^...^.....^..............................................
.............................................................................................................................................
.............................................^...^.^.....^.......^.^.^.^.^.^...^.^.^.^.....^...^.............................................
.............................................................................................................................................
............................................^.^.^.........^.^.....^.^.^.^.^...^.^.^.^.^...^.....^............................................
.............................................................................................................................................
...........................................^.^.^.^...^.....^.^.^.^.^...^...^.^.....^...^...^.^.^.^...........................................
.............................................................................................................................................
..........................................^.....^.^.^.^.^.^...^.....^.^.....^...^...^.^.^.^.^...^.^..........................................
.............................................................................................................................................
.........................................^.^...^.^.....^.^...^.^.^.^.^.^.^.^.^.^...^.....^.....^.^.^.........................................
.............................................................................................................................................
........................................^.....^.^.^.^.^.^.^...^...^.^.^.^.......^.^.^.^.^.^.^.^.^.^.^........................................
.............................................................................................................................................
.......................................^.^.^.^.^.^.^.^...^.^...^.^.^.^...^...^.....^.^.^...^.^...^.^.^.......................................
.............................................................................................................................................
......................................^.......^.^.........^...^.............^.^.^.^...^.^.^.^.^.^.^.^.^......................................
.............................................................................................................................................
.....................................^.^.^...^.^.^.^.....^.^.^...^.^.^.^.....^.^.^.^...^.......^.^...^.^.....................................
.............................................................................................................................................
....................................^...^.^...^.^.^...^.....^...^.......^.^.......^...^...^.^.^.^...^...^....................................
.............................................................................................................................................
...................................^.^.^.^.^.......^.^...^.^...^.^...^.^...^...^.^.^...^.^.^.^.^.^.^.^.^.^...................................
.............................................................................................................................................
..................................^.........^.^.^.^.^...^.^.^...^.^.^...^.^.^.^...^...^.^.^.....^...^.^.^.^..................................
.............................................................................................................................................
.................................^.^.^...^...^.^.....^.^.^.^...^.^.^.^.^.^.^...^...^.^.^...^.^.^.^...^.^.^.^.................................
.............................................................................................................................................
................................^.^.....^...^.....^...^.^...^.^.^.^...^...^.^.^.^.^.^...^.^.^.^.^.^.^...^.^.^................................
.............................................................................................................................................
...............................^...^.^...^.^.^...^...^.^.^.^.^.^...^.^.^.^...^.^.^.^.^...^...^...^.^.^.....^.^...............................
.............................................................................................................................................
..............................^.^.....^.^.^.^.....^.^.^.....^.^.^.^.^.^.......^...^.^.^.^.^...^.^.^.^.^.^.^.^.^..............................
.............................................................................................................................................
.............................^.^.....^...^.^.^.......^.^...^.^.^...^...^.^...^...^.^...^.^.^.^.^.^.^.^...^.^...^.............................
.............................................................................................................................................
............................^.....^.^...^.^.^.......^.^.^.^.......^.^.^.^.^.^.^...^.^.^.^...^...^.......^.^.^.^.^............................
.............................................................................................................................................
...........................^.^.^...^...^.^.^.^...^.^.^.^.^.....^...^...^.....^...^.^.^.^.^.........^.^.....^.^.^.^...........................
.............................................................................................................................................
..........................^.^...^.^...^.^.^.^.......^.^.^.^.^...^.^.....^.^.^.....^.....^...^.......^.^.^.^.^.....^..........................
.............................................................................................................................................
.........................^.^.^.^.....^.^...^.^.^.^.^.^.^.^...^.^.^.....^.^.^...^.^...^.^...^...^...^...^.^.^.^...^.^.........................
.............................................................................................................................................
........................^.^.^...^.^.^.^...^.....^...^.^.^.^.^.^...^.....^.^.^.^.^.^...^...^.^...........^...^...^...^........................
.............................................................................................................................................
.......................^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.......^.^.^.^.^.^...^...^...^.^.^.^.^.......^.^.^.^.^.^.^.......................
.............................................................................................................................................
......................^.......^.^.^.^...^.^...^.^...^.^...^.^.^.^.^...^.^.^...^...^.^...^...^.^.^.^.^.^.^.^.^.....^.^.^......................
.............................................................................................................................................
.....................^...^.....^.^.....^.^.^.^...^.^.^.....^.....^.^.^...^...^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.....................
.............................................................................................................................................
....................^...^...^.^.^.^...^.^...^.^.^.^...^...^.^.^.^...^.^.^.^.^...^.^.......^.^.^.^...^...^.....^.^.....^.^....................
.............................................................................................................................................
...................^...^.^.^.^...^...^.^.....^...^.^.^.^.^.^.^.^.^.^.....^.^...^.....^...^.^...^.^...^.^.^.^.^...^.^...^.^...................
.............................................................................................................................................
..................^.^.....^...^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.....^.^.^.^.^.....^.^.^.^...^.^...^.^.^.^.^..................
.............................................................................................................................................
.................^.^...^.^.^.^.^.^.^.^.^...^.^.....^.....^.^.^.^...^.^.^.^...^...^...^.^.^.^.^.^.^.......^.....^.^.....^...^.................
.............................................................................................................................................
................^.^.^.........^...^.^...^.^.^.^.^.^...^...^...^.^.^...^.^.......^.^.^...^...^.^.^.^.^.^...^...^.....^.^.....^................
.............................................................................................................................................
...............^.^.......^.^.^.^...^.^.^...^.^...^.^.^.^...^.....^.^.....^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^...^.^...^.^.....^.^...............
.............................................................................................................................................
..............^.^.^.^...^.....^.^.^.^.^.^...^...^.^.^.^...^.^.....^.^...^.....^.^...^...^...^.^.^...^.^.....^...^.^.^.^.^.^.^.^..............
.............................................................................................................................................
.............^.^.^.^.^.^.^.^.^.....^...^...^...^.......^.^.^...^...^...^.^...^...^.....^.^.......^.^.....^...^...^.....^.^.^.^.^.............
.............................................................................................................................................
............^.^.......^.....^.^.^.^.^.^.^.^.^.^.....^.^.^...^.^.^.^.^.^...^.......^.^.^...^...^...^...........^.^.^.^...^...^.^.^............
.............................................................................................................................................
...........^...^.^.....^.^.^.^.^.^...^.....^...^...^.^.^.^.^.^...^.^.^.^.^.^.^...^.....^.^.^.....^...^.^.^.^.....^.^.^.^.......^.^...........
.............................................................................................................................................
..........^.^...^...^.^.^.^.^.^.....^.........^...^.^.^.^.^.^...^.^.^.........^.^.^.^.^...^...^.^.^.^.^...^.^.^.^...^.^.^.^.^...^.^..........
.............................................................................................................................................
.........^.^.^...^.......^.^.^.^.^.....^...^.^...^...^.^...^...^...^.^.^.^.^.^.^.^.^.^.^.....^...^.^.^.....^...^.^.^.^.....^...^.^.^.........
.............................................................................................................................................
........^.^...^.^.^.^...^...^.....^...^.^.^.....^.^...^.^.^.^.^...^.....^...^.^...^.^.....^.....^.^.^.^...^.^.....^.^.^.....^.^.^.^.^........
.............................................................................................................................................
.......^.^.^.^.....^.........^...^.........^.^.....^.^.^.^.^.^.....^.^.^...^.^...^.^.^.^.^.^.....^.^.^.^.^.^...^.......^.^...^.^.^.^.^.......
.............................................................................................................................................
......^.^.^.....^.^.^.^.^.^...^.^.....^.^.^.^.^...^...^.^.........^.^...^.^.^.^.^.^.^.^.......^.^.^.^.....^...^...^...^...^.^.....^...^......
.............................................................................................................................................
.....^.^.....^.^.^.^.^.^.^.^.....^.^...^.^.^...^.....^...^.^.^.^.^.^...^.............^.^.^...^.^.....^.^.....^.^.....^.^.^.^.^.^.....^.^.....
.............................................................................................................................................
....^.^.^.^.^...^.^...^.......^.^.^.^.^...^.^.^...^.^.^.^.^.^.^.^...^.^.^.^.^...^.^.^.^.^.^...^...^.....^.^.^...^.^...^.^.^...^.^...^.^.^....
.............................................................................................................................................
...^.^.^.^.^.^.....^...^...^.^...^...^.^...^.^...^.^.^.^.......^...^.^.^...^...^.^.^...^.^.^.^...^...^.^.^...^.^.^.^.^.^.^.^.^...^...^.^.^...
.............................................................................................................................................
..^.^.^...^.^.........^.^...^.^.^.^.^.......^.^.....^...^.....^...^...^...^.....^.^.^.....^...^.....^.......^.^.^...^.^.....^.^.....^.^.^.^..
.............................................................................................................................................
.^.^.^.^.^...^...^...^.^...^.^...^.^.^.^.....^.^.^.^.....^.^...^.^.^.^.^.^.^...........^.^.^.^.......^.^.^.^.^...^.^.^.^.^.^.^.^.....^.^...^.
.............................................................................................................................................`
}